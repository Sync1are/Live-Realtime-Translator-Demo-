<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notification Engine - Task Management</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: #333;
      margin-bottom: 30px;
    }

    .section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h2 {
      color: #555;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .controls {
      display: grid;
      gap: 15px;
    }

    .control-group {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 4px;
    }

    label {
      font-weight: 500;
      color: #333;
    }

    input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    input[type="time"] {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }

    button:hover {
      background: #0056b3;
    }

    button.secondary {
      background: #6c757d;
    }

    button.secondary:hover {
      background: #545b62;
    }

    .test-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    .inbox-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .inbox-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: start;
    }

    .inbox-item:last-child {
      border-bottom: none;
    }

    .inbox-item.unread {
      background: #f0f8ff;
      font-weight: 500;
    }

    .inbox-content {
      flex: 1;
    }

    .inbox-date {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }

    .inbox-data {
      font-size: 14px;
      color: #333;
    }

    .status {
      margin-top: 10px;
      padding: 10px;
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      border-radius: 4px;
      font-size: 14px;
    }

    .status.error {
      background: #ffebee;
      border-left-color: #f44336;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîî Notification Engine - Task Management</h1>

    <!-- Daily Stats -->
    <div class="section">
      <h2>Daily Statistics</h2>
      <div class="stats">
        <div class="stat-card">
          <div class="stat-value" id="tasksCompleted">0</div>
          <div class="stat-label">Tasks Completed</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="focusTime">0</div>
          <div class="stat-label">Focus Time (min)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="breakTime">0</div>
          <div class="stat-label">Break Time (min)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="streak">0</div>
          <div class="stat-label">Day Streak</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="pendingRollovers">0</div>
          <div class="stat-label">Pending Rollovers</div>
        </div>
      </div>
    </div>

    <!-- Notification Settings -->
    <div class="section">
      <h2>Notification Settings</h2>
      <div class="controls">
        <div class="control-group">
          <label for="taskReminders">Task Reminders</label>
          <input type="checkbox" id="taskReminders">
        </div>
        <div class="control-group">
          <label for="overdueAlerts">Overdue Alerts</label>
          <input type="checkbox" id="overdueAlerts">
        </div>
        <div class="control-group">
          <label for="endOfDaySummary">End-of-Day Summary</label>
          <input type="checkbox" id="endOfDaySummary">
        </div>
      </div>
    </div>

    <!-- Quiet Hours -->
    <div class="section">
      <h2>Quiet Hours</h2>
      <div class="controls">
        <div class="control-group">
          <label for="quietHoursEnabled">Enable Quiet Hours</label>
          <input type="checkbox" id="quietHoursEnabled">
        </div>
        <div class="control-group">
          <label for="quietHoursStart">Start Time</label>
          <input type="time" id="quietHoursStart">
        </div>
        <div class="control-group">
          <label for="quietHoursEnd">End Time</label>
          <input type="time" id="quietHoursEnd">
        </div>
      </div>
    </div>

    <!-- End-of-Day Time -->
    <div class="section">
      <h2>End-of-Day Summary Time</h2>
      <div class="controls">
        <div class="control-group">
          <label for="eodTime">Summary Time</label>
          <input type="time" id="eodTime">
        </div>
      </div>
    </div>

    <!-- Pomodoro Settings -->
    <div class="section">
      <h2>üçÖ Pomodoro Mode</h2>
      <div class="controls">
        <div class="control-group">
          <label for="pomodoroEnabled">Enable Pomodoro Mode</label>
          <input type="checkbox" id="pomodoroEnabled">
        </div>
        <div class="control-group">
          <label for="pomodoroWorkDuration">Work Duration (minutes)</label>
          <input type="number" id="pomodoroWorkDuration" min="1" max="60" value="25" style="width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div class="control-group">
          <label for="pomodoroBreakDuration">Break Duration (minutes)</label>
          <input type="number" id="pomodoroBreakDuration" min="1" max="30" value="5" style="width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div class="control-group">
          <label for="pomodoroLongBreakDuration">Long Break Duration (minutes)</label>
          <input type="number" id="pomodoroLongBreakDuration" min="1" max="60" value="15" style="width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
      </div>
    </div>

    <!-- Pomodoro Timer -->
    <div class="section" id="pomodoroTimerSection" style="display: none;">
      <h2>Pomodoro Timer</h2>
      <div style="text-align: center; margin: 20px 0;">
        <div style="font-size: 48px; font-weight: bold; color: #667eea; margin-bottom: 10px;" id="pomodoroTimer">25:00</div>
        <div style="font-size: 18px; color: #666; margin-bottom: 20px;" id="pomodoroPhase">Ready to work</div>
        <div style="font-size: 14px; color: #999; margin-bottom: 20px;" id="pomodoroCycle">Cycle 1</div>
      </div>
      <div class="test-buttons" style="justify-content: center;">
        <button onclick="startPomodoroWork()">‚ñ∂Ô∏è Start Work</button>
        <button onclick="pausePomodoro()">‚è∏Ô∏è Pause</button>
        <button onclick="resumePomodoro()">‚ñ∂Ô∏è Resume</button>
        <button onclick="skipPomodoro()">‚è≠Ô∏è Skip</button>
        <button onclick="extendPomodoro()">‚è±Ô∏è +5 min</button>
      </div>
      <div style="margin-top: 20px;">
        <h3 style="font-size: 14px; color: #666; margin-bottom: 10px;">Upcoming Cycles:</h3>
        <div id="upcomingCycles" style="font-size: 12px; color: #888;"></div>
      </div>
    </div>

    <!-- Break Reminder Settings -->
    <div class="section">
      <h2>Break Reminders</h2>
      <div class="controls">
        <div class="control-group">
          <label for="breakReminderEnabled">Enable Break Reminders (non-Pomodoro)</label>
          <input type="checkbox" id="breakReminderEnabled">
        </div>
        <div class="control-group">
          <label for="breakReminderInterval">Remind After (minutes)</label>
          <input type="number" id="breakReminderInterval" min="15" max="180" value="60" style="width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
      </div>
    </div>

    <!-- Timer Analytics -->
    <div class="section">
      <h2>Focus & Break Analytics</h2>
      <div id="analyticsContent">
        <p style="color: #999;">Loading analytics...</p>
      </div>
    </div>

    <!-- Test Notifications -->
    <div class="section">
      <h2>Test Notifications</h2>
      <div class="test-buttons">
        <button onclick="testNotification('reminder')">Test Task Reminder</button>
        <button onclick="testNotification('overdue')">Test Overdue Alert</button>
        <button onclick="testNotification('summary')">Test Daily Summary</button>
        <button class="secondary" onclick="triggerSummary()">Trigger Daily Summary Now</button>
      </div>
    </div>

    <!-- Inbox -->
    <div class="section">
      <h2>Notification Inbox (<span id="unreadCount">0</span> unread)</h2>
      <button onclick="markAllAsRead()" style="margin-bottom: 15px;">Mark All as Read</button>
      <div class="inbox-list" id="inboxList">
        <p style="color: #999; padding: 20px; text-align: center;">No notifications yet</p>
      </div>
    </div>

    <!-- Status -->
    <div id="statusMessage"></div>
  </div>

  <script>
    // Initialize
    let currentSettings = {};
    let pomodoroStatus = null;

    // Load settings and stats on startup
    async function initialize() {
      await loadSettings();
      await loadDailyStats();
      await loadInbox();
      await loadPomodoroSettings();
      await loadTimerSettings();
      await loadAnalytics();
      setupPomodoroEventListeners();
    }

    // Load settings
    async function loadSettings() {
      try {
        const settings = await window.notificationAPI.getSettings();
        currentSettings = settings;

        // Apply to UI
        document.getElementById('taskReminders').checked = settings.notifications.taskReminders;
        document.getElementById('overdueAlerts').checked = settings.notifications.overdueAlerts;
        document.getElementById('endOfDaySummary').checked = settings.notifications.endOfDaySummary;
        document.getElementById('quietHoursEnabled').checked = settings.notifications.quietHours.enabled;
        document.getElementById('quietHoursStart').value = settings.notifications.quietHours.start;
        document.getElementById('quietHoursEnd').value = settings.notifications.quietHours.end;
        document.getElementById('eodTime').value = settings.endOfDay.summaryTime;

        showStatus('Settings loaded successfully');
      } catch (error) {
        showStatus('Failed to load settings: ' + error.message, true);
      }
    }

    // Load daily stats
    async function loadDailyStats() {
      try {
        const stats = await window.notificationAPI.getDailyStats();
        
        document.getElementById('tasksCompleted').textContent = stats.tasksCompleted;
        document.getElementById('focusTime').textContent = stats.focusTime;
        document.getElementById('breakTime').textContent = stats.breakTime || 0;
        document.getElementById('streak').textContent = stats.streak;
        document.getElementById('pendingRollovers').textContent = stats.pendingRollovers;
      } catch (error) {
        showStatus('Failed to load daily stats: ' + error.message, true);
      }
    }

    // Load inbox
    async function loadInbox() {
      try {
        const items = await window.notificationAPI.getInboxItems();
        const unreadCount = await window.notificationAPI.getUnreadCount();
        
        document.getElementById('unreadCount').textContent = unreadCount;
        
        const inboxList = document.getElementById('inboxList');
        
        if (items.length === 0) {
          inboxList.innerHTML = '<p style="color: #999; padding: 20px; text-align: center;">No notifications yet</p>';
          return;
        }
        
        inboxList.innerHTML = items.map(item => `
          <div class="inbox-item ${item.read ? '' : 'unread'}">
            <div class="inbox-content">
              <div class="inbox-date">${new Date(item.timestamp).toLocaleString()}</div>
              <div class="inbox-data">${formatInboxData(item)}</div>
            </div>
          </div>
        `).join('');
      } catch (error) {
        showStatus('Failed to load inbox: ' + error.message, true);
      }
    }

    // Format inbox data
    function formatInboxData(item) {
      if (item.type === 'dailySummary') {
        const data = item.data;
        return `üìä Daily Summary: ${data.tasksCompleted} tasks, ${data.focusTime} min focus, ${data.streak} day streak`;
      }
      return JSON.stringify(item.data);
    }

    // Event listeners for settings
    document.getElementById('taskReminders').addEventListener('change', async (e) => {
      await window.notificationAPI.setTaskReminders(e.target.checked);
      showStatus('Task reminders ' + (e.target.checked ? 'enabled' : 'disabled'));
    });

    document.getElementById('overdueAlerts').addEventListener('change', async (e) => {
      await window.notificationAPI.setOverdueAlerts(e.target.checked);
      showStatus('Overdue alerts ' + (e.target.checked ? 'enabled' : 'disabled'));
    });

    document.getElementById('endOfDaySummary').addEventListener('change', async (e) => {
      await window.notificationAPI.setEndOfDaySummary(e.target.checked);
      showStatus('End-of-day summary ' + (e.target.checked ? 'enabled' : 'disabled'));
    });

    document.getElementById('quietHoursEnabled').addEventListener('change', async (e) => {
      await window.notificationAPI.setQuietHours({
        enabled: e.target.checked
      });
      showStatus('Quiet hours ' + (e.target.checked ? 'enabled' : 'disabled'));
    });

    document.getElementById('quietHoursStart').addEventListener('change', async (e) => {
      await window.notificationAPI.setQuietHours({
        start: e.target.value
      });
      showStatus('Quiet hours start time updated');
    });

    document.getElementById('quietHoursEnd').addEventListener('change', async (e) => {
      await window.notificationAPI.setQuietHours({
        end: e.target.value
      });
      showStatus('Quiet hours end time updated');
    });

    document.getElementById('eodTime').addEventListener('change', async (e) => {
      await window.notificationAPI.setEndOfDayTime(e.target.value);
      showStatus('End-of-day summary time updated');
    });

    // Test notification
    async function testNotification(type) {
      try {
        await window.notificationAPI.testNotification(type);
        showStatus('Test notification sent: ' + type);
      } catch (error) {
        showStatus('Failed to send test notification: ' + error.message, true);
      }
    }

    // Trigger summary
    async function triggerSummary() {
      try {
        await window.notificationAPI.triggerSummary();
        showStatus('Daily summary triggered');
        setTimeout(loadInbox, 1000);
      } catch (error) {
        showStatus('Failed to trigger summary: ' + error.message, true);
      }
    }

    // Mark all as read
    async function markAllAsRead() {
      try {
        await window.notificationAPI.markAllAsRead();
        showStatus('All notifications marked as read');
        loadInbox();
      } catch (error) {
        showStatus('Failed to mark as read: ' + error.message, true);
      }
    }

    // Show status message
    function showStatus(message, isError = false) {
      const statusEl = document.getElementById('statusMessage');
      statusEl.textContent = message;
      statusEl.className = 'status' + (isError ? ' error' : '');
      
      setTimeout(() => {
        statusEl.textContent = '';
        statusEl.className = '';
      }, 5000);
    }

    // Listen for notification events
    window.notificationAPI.onNotificationClicked((data) => {
      console.log('Notification clicked:', data);
      showStatus('Notification clicked: ' + data.type);
    });

    window.notificationAPI.onTaskAction((data) => {
      console.log('Task action:', data);
      showStatus('Task action: ' + data.action);
      loadDailyStats();
    });

    // Load Pomodoro settings
    async function loadPomodoroSettings() {
      try {
        const settings = await window.notificationAPI.pomodoroGetSettings();
        
        document.getElementById('pomodoroEnabled').checked = settings.enabled;
        document.getElementById('pomodoroWorkDuration').value = settings.workDuration;
        document.getElementById('pomodoroBreakDuration').value = settings.breakDuration;
        document.getElementById('pomodoroLongBreakDuration').value = settings.longBreakDuration;
        
        // Show/hide timer section based on enabled state
        document.getElementById('pomodoroTimerSection').style.display = settings.enabled ? 'block' : 'none';
        
        if (settings.enabled) {
          await updatePomodoroStatus();
          await updateUpcomingCycles();
        }
      } catch (error) {
        console.error('Failed to load Pomodoro settings:', error);
      }
    }

    // Load Timer settings
    async function loadTimerSettings() {
      try {
        const settings = await window.notificationAPI.timerGetSettings();
        
        document.getElementById('breakReminderEnabled').checked = settings.breakReminderEnabled;
        document.getElementById('breakReminderInterval').value = settings.breakReminderInterval;
      } catch (error) {
        console.error('Failed to load Timer settings:', error);
      }
    }

    // Load analytics
    async function loadAnalytics() {
      try {
        const analytics = await window.notificationAPI.timerGetAnalytics();
        const content = document.getElementById('analyticsContent');
        
        content.innerHTML = `
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div style="padding: 15px; background: #f9f9f9; border-radius: 4px;">
              <div style="font-size: 24px; font-weight: bold; color: #667eea;">${analytics.focusSessions.count}</div>
              <div style="font-size: 12px; color: #666;">Focus Sessions</div>
              <div style="font-size: 12px; color: #999;">${analytics.focusSessions.totalMinutes} min total</div>
            </div>
            <div style="padding: 15px; background: #f9f9f9; border-radius: 4px;">
              <div style="font-size: 24px; font-weight: bold; color: #764ba2;">${analytics.breakSessions.count}</div>
              <div style="font-size: 12px; color: #666;">Break Sessions</div>
              <div style="font-size: 12px; color: #999;">${analytics.breakSessions.totalMinutes} min total</div>
            </div>
            <div style="padding: 15px; background: #f9f9f9; border-radius: 4px;">
              <div style="font-size: 24px; font-weight: bold; color: #4caf50;">${analytics.focusBreakRatio}</div>
              <div style="font-size: 12px; color: #666;">Focus/Break Ratio</div>
              <div style="font-size: 12px; color: #999;">Last 7 days</div>
            </div>
            <div style="padding: 15px; background: #f9f9f9; border-radius: 4px;">
              <div style="font-size: 24px; font-weight: bold; color: #ff9800;">${analytics.focusSessions.pomodoroCount}</div>
              <div style="font-size: 12px; color: #666;">Pomodoro Sessions</div>
              <div style="font-size: 12px; color: #999;">${analytics.breakSessions.longBreaks} long breaks</div>
            </div>
          </div>
        `;
      } catch (error) {
        console.error('Failed to load analytics:', error);
      }
    }

    // Update Pomodoro status
    async function updatePomodoroStatus() {
      try {
        pomodoroStatus = await window.notificationAPI.pomodoroGetStatus();
        
        if (pomodoroStatus.phase) {
          const minutes = Math.floor(pomodoroStatus.remainingSeconds / 60);
          const seconds = pomodoroStatus.remainingSeconds % 60;
          document.getElementById('pomodoroTimer').textContent = 
            `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
          
          document.getElementById('pomodoroPhase').textContent = 
            pomodoroStatus.phase === 'work' ? 'üíº Work Session' : '‚òï Break Time';
          
          document.getElementById('pomodoroCycle').textContent = 
            `Cycle ${pomodoroStatus.currentCycle + 1}`;
        }
      } catch (error) {
        console.error('Failed to update Pomodoro status:', error);
      }
    }

    // Update upcoming cycles
    async function updateUpcomingCycles() {
      try {
        const cycles = await window.notificationAPI.pomodoroGetUpcomingCycles(5);
        const content = cycles.map(c => 
          `Cycle ${c.cycle}: ${c.workDuration}m work ‚Üí ${c.breakDuration}m ${c.isLongBreak ? 'long ' : ''}break`
        ).join('<br>');
        document.getElementById('upcomingCycles').innerHTML = content;
      } catch (error) {
        console.error('Failed to update upcoming cycles:', error);
      }
    }

    // Pomodoro controls
    async function startPomodoroWork() {
      try {
        await window.notificationAPI.pomodoroStartWork(null);
        showStatus('Pomodoro work session started');
      } catch (error) {
        showStatus('Failed to start work session: ' + error.message, true);
      }
    }

    async function pausePomodoro() {
      try {
        await window.notificationAPI.pomodoroPause();
        showStatus('Pomodoro paused');
      } catch (error) {
        showStatus('Failed to pause: ' + error.message, true);
      }
    }

    async function resumePomodoro() {
      try {
        await window.notificationAPI.pomodoroResume();
        showStatus('Pomodoro resumed');
      } catch (error) {
        showStatus('Failed to resume: ' + error.message, true);
      }
    }

    async function skipPomodoro() {
      try {
        await window.notificationAPI.pomodoroSkip();
        showStatus('Session skipped');
      } catch (error) {
        showStatus('Failed to skip: ' + error.message, true);
      }
    }

    async function extendPomodoro() {
      try {
        await window.notificationAPI.pomodoroExtend(5);
        showStatus('Session extended by 5 minutes');
      } catch (error) {
        showStatus('Failed to extend: ' + error.message, true);
      }
    }

    // Setup Pomodoro event listeners
    function setupPomodoroEventListeners() {
      window.notificationAPI.onPomodoroTimerTick((data) => {
        const minutes = Math.floor(data.remainingSeconds / 60);
        const seconds = data.remainingSeconds % 60;
        document.getElementById('pomodoroTimer').textContent = 
          `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      });

      window.notificationAPI.onPomodoroWorkStarted((data) => {
        document.getElementById('pomodoroPhase').textContent = 'üíº Work Session';
        document.getElementById('pomodoroCycle').textContent = `Cycle ${data.cycle}`;
        showStatus('Work session started!');
      });

      window.notificationAPI.onPomodoroBreakStarted((data) => {
        document.getElementById('pomodoroPhase').textContent = data.isLongBreak ? 'üåü Long Break' : '‚òï Break Time';
        showStatus(data.isLongBreak ? 'Long break started!' : 'Break started!');
      });

      window.notificationAPI.onPomodoroSessionCompleted((data) => {
        loadDailyStats();
        loadAnalytics();
      });
    }

    // Event listeners for Pomodoro settings
    document.getElementById('pomodoroEnabled').addEventListener('change', async (e) => {
      try {
        if (e.target.checked) {
          await window.notificationAPI.pomodoroEnable();
          document.getElementById('pomodoroTimerSection').style.display = 'block';
          await updatePomodoroStatus();
          await updateUpcomingCycles();
        } else {
          await window.notificationAPI.pomodoroDisable();
          document.getElementById('pomodoroTimerSection').style.display = 'none';
        }
        showStatus('Pomodoro mode ' + (e.target.checked ? 'enabled' : 'disabled'));
      } catch (error) {
        showStatus('Failed to toggle Pomodoro: ' + error.message, true);
      }
    });

    document.getElementById('pomodoroWorkDuration').addEventListener('change', async (e) => {
      try {
        await window.notificationAPI.pomodoroUpdateSettings({ workDuration: parseInt(e.target.value) });
        showStatus('Work duration updated');
        await updateUpcomingCycles();
      } catch (error) {
        showStatus('Failed to update work duration: ' + error.message, true);
      }
    });

    document.getElementById('pomodoroBreakDuration').addEventListener('change', async (e) => {
      try {
        await window.notificationAPI.pomodoroUpdateSettings({ breakDuration: parseInt(e.target.value) });
        showStatus('Break duration updated');
        await updateUpcomingCycles();
      } catch (error) {
        showStatus('Failed to update break duration: ' + error.message, true);
      }
    });

    document.getElementById('pomodoroLongBreakDuration').addEventListener('change', async (e) => {
      try {
        await window.notificationAPI.pomodoroUpdateSettings({ longBreakDuration: parseInt(e.target.value) });
        showStatus('Long break duration updated');
        await updateUpcomingCycles();
      } catch (error) {
        showStatus('Failed to update long break duration: ' + error.message, true);
      }
    });

    // Event listeners for Timer settings
    document.getElementById('breakReminderEnabled').addEventListener('change', async (e) => {
      try {
        await window.notificationAPI.timerUpdateSettings({ breakReminderEnabled: e.target.checked });
        showStatus('Break reminders ' + (e.target.checked ? 'enabled' : 'disabled'));
      } catch (error) {
        showStatus('Failed to toggle break reminders: ' + error.message, true);
      }
    });

    document.getElementById('breakReminderInterval').addEventListener('change', async (e) => {
      try {
        await window.notificationAPI.timerUpdateSettings({ breakReminderInterval: parseInt(e.target.value) });
        showStatus('Break reminder interval updated');
      } catch (error) {
        showStatus('Failed to update interval: ' + error.message, true);
      }
    });

    // Initialize on load
    initialize();

    // Refresh stats, inbox, and analytics periodically
    setInterval(() => {
      loadDailyStats();
      loadInbox();
      loadAnalytics();
      if (document.getElementById('pomodoroEnabled').checked) {
        updatePomodoroStatus();
      }
    }, 30000); // Every 30 seconds
  </script>
</body>
</html>
